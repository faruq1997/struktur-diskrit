<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Combination Picker — Struktur Diskrit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 & jQuery -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body { background:#0f172a; color:#e2e8f0; font-family:'Segoe UI',sans-serif; }
    .navbar { background:#111827; }
    .card { background:#1e293b; border:none; border-radius:10px; }
    .person-btn {
      width:100%; padding:10px; margin:5px 0; border-radius:8px;
      border:1px solid #334155; background:#0f172a; color:#e2e8f0;
      transition:all .2s ease-in-out;
    }
    .person-btn.active { background:#6366f1; color:white; border-color:#818cf8; }
    .person-btn:hover { background:#334155; }
    #combinationList { max-height:200px; overflow-y:auto; font-family:monospace; background:#0b1220; padding:10px; border-radius:8px; }
    .badge-soft { background:rgba(99,102,241,.12); color:#c7d2fe; border:1px solid rgba(99,102,241,.35); }
    .result-area { background:#0b1220; padding:15px; border-radius:10px; }
    .modal-content { background:#111827; color:#e2e8f0; }
  </style>
</head>

<body>
<nav class="navbar border-bottom border-secondary">
  <div class="container-fluid">
    <span class="navbar-brand text-light fw-bold">🎯 Combination Picker</span>
    <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#helpModal">Bantuan</button>
  </div>
</nav>

<div class="container my-4">
  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card p-3 h-100">
        <h5 class="mb-2">🧑‍🤝‍🧑 Daftar Kandidat</h5>
        <div id="candidateList" class="row"></div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card p-3 h-100">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Soal</h5>
          <span class="badge badge-soft">Skor: <span id="score">0</span></span>
        </div>
        <hr>
        <p id="questionText" class="fs-5 mb-3"></p>

        <div class="result-area mb-3">
          <p class="mb-1"><strong>Pilihan Anda:</strong> <span id="selectedItems">–</span></p>
          <p class="mb-1"><strong>Total kombinasi mungkin:</strong> <span id="combTotal">–</span></p>
        </div>

        <div class="d-flex flex-wrap gap-2">
          <button id="checkBtn" class="btn btn-primary flex-fill">Periksa Jawaban</button>
          <button id="nextBtn" class="btn btn-outline-light flex-fill">Soal Berikutnya</button>
        </div>

        <div class="mt-4">
          <h6>💡 Kombinasi yang mungkin:</h6>
          <div id="combinationList"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Bantuan -->
<div class="modal fade" id="helpModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Panduan Permainan</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Setiap soal akan memberi perintah seperti “Pilih 3 dari 6 anggota.”</li>
          <li>Klik nama-nama untuk memilih sebanyak <code>r</code> anggota.</li>
          <li>Tekan <strong>Periksa Jawaban</strong> untuk memvalidasi pilihan.</li>
          <li>Skor +10 jika benar. Tekan <strong>Soal Berikutnya</strong> untuk lanjut.</li>
        </ul>
        <p>Kombinasi total dihitung dengan rumus <code>C(n, r) = n! / (r!(n−r)!)</code>.</p>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== Kombinatorika util ===== */
function fact(n){ let r=1n; for(let i=2n;i<=n;i++) r*=i; return r; }
function comb(n,r){ if(r>n) return 0n; if(r>n-r) r=n-r;
  let num=1n, den=1n;
  for(let i=1n;i<=r;i++){ num*=(n-r+i); den*=i; }
  return num/den;
}

/* ===== Variabel Game ===== */
let n=0, r=0, score=0, selected=[], candidates=[];

/* ===== Generate Soal ===== */
function newQuestion(){
  n = Math.floor(Math.random()*3)+5;   // 5–7 kandidat
  r = Math.floor(Math.random()*(n-3))+2; // 2–(n-2)
  selected = [];
  $("#questionText").text(`Pilih ${r} dari ${n} kandidat berikut untuk membentuk tim.`);
  $("#selectedItems").text("–");
  $("#combTotal").text(comb(BigInt(n), BigInt(r)).toString());
  generateCandidates();
  showCombinations();
}

/* ===== Generate Daftar Kandidat ===== */
function generateCandidates(){
  const names = ["Andi","Budi","Citra","Dewi","Eka","Fajar","Gita","Hadi","Intan","Joko","Kiki","Lina"];
  candidates = names.slice(0,n);
  const list = $("#candidateList").empty();
  candidates.forEach((name, i)=>{
    const btn = $(`<div class="col-6 col-md-4"><button class="person-btn" data-idx="${i}">${name}</button></div>`);
    list.append(btn);
  });
}

/* ===== Menangani Klik Kandidat ===== */
$(document).on("click",".person-btn",function(){
  const idx = $(this).data("idx");
  if(selected.includes(idx)){
    selected = selected.filter(x=>x!==idx);
    $(this).removeClass("active");
  }else{
    if(selected.length<r){ selected.push(idx); $(this).addClass("active"); }
    else{
      // jika sudah penuh, beri animasi
      $(this).addClass("shake");
      setTimeout(()=>$(this).removeClass("shake"),300);
    }
  }
  const names = selected.map(i=>candidates[i]);
  $("#selectedItems").text(names.length>0?names.join(", "):"–");
});

/* ===== Menampilkan Semua Kombinasi Kemungkinan ===== */
function showCombinations(){
  const list = $("#combinationList").empty();
  const all = generateCombinations(candidates, r);
  all.forEach(c=>{
    list.append(`<div>${c.join(", ")}</div>`);
  });
}

/* Fungsi kombinasi rekursif */
function generateCombinations(arr, r){
  if(r===0) return [[]];
  if(arr.length<r) return [];
  const [first, ...rest] = arr;
  const withFirst = generateCombinations(rest, r-1).map(c=>[first,...c]);
  const withoutFirst = generateCombinations(rest, r);
  return withFirst.concat(withoutFirst);
}

/* ===== Cek Jawaban ===== */
function checkAnswer(){
  if(selected.length!==r){
    alert(`Pilih tepat ${r} anggota!`);
    return;
  }
  const userCombo = selected.map(i=>candidates[i]).sort();
  const allComb = generateCombinations(candidates, r).map(c=>c.sort().join(","));
  if(allComb.includes(userCombo.join(","))){
    score+=10;
    $("#score").text(score);
    alert("✅ Kombinasi valid! Skor +10");
  }else{
    alert("❌ Kombinasi tidak valid.");
  }
}

/* ===== Next Soal ===== */
$("#checkBtn").on("click", checkAnswer);
$("#nextBtn").on("click", newQuestion);

/* ===== Init ===== */
$(function(){ newQuestion(); });
</script>
</body>
</html>
